{% extends "baseControl.html" %}
{% load static %}
{% block titulo %} Administración de Empleados {% endblock %}
{% block content %}
<div class="container pt-4">
    <h1 class="fw-bold text-secondary">Administración de Empleados</h2>    
</div>
<div class="container pt-4 d-none d-sm-block">
    <div class="row ">
        <div class="col-lg-4">
            <div class="p-3 border rounded text-secondary">Empleados registrados:</div>
        </div>
        <div class="col-lg-4">
            <div class="p-3 border rounded text-secondary">Empleados habilitados:</div>
        </div>
        <div class="col-lg-4">
            <div class="p-3 border rounded text-secondary">Empleados inactivos: </div>
        </div>
    </div>
</div>
<div class="container pt-4">
    <div class="row">
        <div class="col-9 col-lg-11">
        <!--Busqueda por Apellidos-->
            <div class="input-group  py-4">
                <span class="input-group-text bg-white d-none d-sm-block" id="basic-addon1">
                    <span class="material-symbols-outlined btn-sm " id="search_voff">face</span>
                </span>
                <input type="text" class="form-control" id="id_apellido_paciente" placeholder="Apellidos" aria-label="Nombres" aria-describedby="basic-addon1">
                <span class="input-group-text bg-white" id="filtro_buscar">
                    <span class="material-symbols-outlined btn btn-sm" id="" data-bs-toggle="modal" data-bs-target="#busquedaPacienteModal">search</span>
                </span>
            </div>
        </div>
        <!--Agregar Empleado-->
        <div class="col-3 col-lg-1">
            <div class="input-group py-4 text-center px-1">
                <span class="input-group-text bg-white" id="basic-addon1">
                    <span class="material-symbols-outlined btn btn-sm" id="search_voff" data-bs-toggle="modal" data-bs-target="#agregarEmpleadoModal">person_add</span>
                </span>
            </div>
        </div>
    </div>
</div>
<div class="container">

</div>

    <!--Modal Crear Empleado-->
    <div class="modal fade" id="agregarEmpleadoModal" tabindex="-1" aria-hidden="true" aria-labelledby="modalTitle">
        <div class="modal-dialog modal-xl">
          <div class="modal-content">
            <div class="modal-header text-center">
                <h5 class="modal-title w-100">Registrar Empleado</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
            </div>
            <div class="modal-body">
              <div class="container">
                
                <form class="row g-3 needs-validation" action="" autocomplete="off" novalidate>
                    <div class="col-12">
                        <div class="fw-bold border-bottom bg-secondary text-white">
                            Datos Personales
                        </div>
                    </div>
                    <div class="col-md-6">
                      <label for="validationCustom01" class="form-label">Nombres</label>
                      <input type="text" class="form-control" id="id_nombre_empleado" value="" required>
                      <div class="valid-feedback">
                        ¡Correcto!
                      </div>
                    </div>
                    <div class="col-md-6">
                      <label for="validationCustom02" class="form-label">Apellidos</label>
                      <input type="text" class="form-control" id="id_apellido_empleado" value="" required>
                      <div class="valid-feedback">
                        ¡Correcto!
                      </div>
                    </div>
                    
                    <!--Dirección-->
                    <div class="col-md-4">
                        <label for="validationCustom02" class="form-label">Direccion</label>
                        <input type="text" class="form-control" id="id_direccion_empleado" value="" required>
                        <div class="valid-feedback">
                          Looks good!
                        </div>
                      </div>
                    <!--Fecha nacimiento-->
                    <div class="col-md-4">
                        <label for="id_fecha_nacimiento" class="form-label">Fecha de nacimiento</label> 
                        <input type="date" class="form-control" placeholder="Select a date" id="id_fecha_nacimiento" required>
                        <div class="valid-feedback">
                            Looks good!
                        </div>
                    </div>
                    <!--Sexo-->
                    <div class="col-md-4">
                        <label for="validationCustom04" class="form-label">Sexo</label>
                        <select class="form-select" id="id_select_sexo" required>
                          <option selected disabled value="">Selecione...</option>
                          <option value="1">Maculino</option>
                          <option value="2">Femenino</option>
                        </select>
                        <div class="invalid-feedback">
                          Seleccione el sexo.
                        </div>
                    </div>
                    <!--Separador-->
                    <div class="col-12">
                        <div class="fw-bold border-bottom bg-secondary text-white">
                            Datos de inicio de sesión
                        </div>
                    </div>

                    <!--Email-->
                    <div class="col-md-6">
                        <label for="validationCustomUsername" class="form-label">Email</label>
                        <div class="input-group has-validation">
                          <span class="input-group-text" id="inputGroupPrepend">@</span>
                          <input type="text" class="form-control" id="id_email_empleado" aria-describedby="inputGroupPrepend" required>
                          <div class="invalid-feedback">
                            Ingrese el correo electrónico.
                          </div>
                        </div>
                      </div>
                      <!--Password-->
                    <div class="col-md-6">
                          <label for="validationCustomUsername" class="form-label">Contraseña</label>
                          <div class="input-group has-validation">
                            <input type="password" class="form-control" id="id_password_empleado" aria-describedby="inputGroupPrepend" required>
                            <div class="invalid-feedback" id="passwordError">
                              Ingrese una contraseña.
                            </div>
                          </div>
                    </div>
                    <!--Separador-->
                    <div class="col-12">
                        <div class="fw-bold border-bottom bg-secondary text-white">
                            Roles
                        </div>
                    </div>
                    <div class="col-6">
                        <p class="form-label">Seleccione el cargo del empleado: </label>
                    </div>
                    <div class="col-lg-6">
                        <select class="form-select" id="id_rol" required>
                            <option selected disabled value="">Selecione...</option>
                            {% for i in Rol %}
                            <option value="{{ i.id_rol }}">{{ i.nombre_rol }}</option>
                            {% endfor %}
                          </select>
                          <div class="invalid-feedback">
                            Seleccione un rol.
                          </div>
                    </div>
                    <div class="col-12 text-end">
                      <button class="btn btn-success" id="guardar_empleado" >Guardar Datos</button>
                    </div>
                </form>

              </div>
            </div>
          </div>
        </div>
    </div>
{% endblock %}
{% block js %}
<script>
    url="{% url 'registrarEmpleado' %}";
    let nombres;
    let apellidos;
    let email;
    let password;
    let direccion;
    let fecha_nacimiento;
    let sexo;

    document.getElementById("guardar_empleado").addEventListener("click",function(){
        nombres =  document.getElementById("id_nombre_empleado").value;
        apellidos =  document.getElementById("id_apellido_empleado").value;
        email = document.getElementById("id_email_empleado").value;
        password = document.getElementById("id_password_empleado").value;
        direccion = document.getElementById("id_direccion_empleado").value;
        fecha_nacimiento = document.getElementById("id_fecha_nacimiento").value;
        sexo = $('#id_select_sexo').val();
        rol = $('#id_rol').val;
        if ($("id_password_empleado").length <8){
                $("id_password_empleado").addClass("is-invalid");
                document.getElementById("passwordError").innerHTML=null;
                parrafoError="<p>Debe tener almenos 6 caracteres.</p>";
                document.getElementById("passwordError").insertAdjacentHTML("beforeend",parrafoError);
              }
        if (nombres!="", apellidos!="", email!="", password!="", direccion!="",fecha_nacimiento!="", sexo!=""){
            //is-invalid
          $.ajax({
            url: url,
            type:"POST",
            dataType: "json",
            data: {
                'nombre_empleado':nombres,
                'apellido_empleado':apellidos,
                'email_empleado':email,
                'password_empleado':password,
                'direccion_empleado':direccion,
                'fecha_nacimiento':fecha_nacimiento,
                'sexo_empleado':sexo,
                'rol_empleado':rol
            },
            success: function(data){  
                toastr[data.type](data.data);
                if (data.pass =="0"){
                    password = document.getElementById("id_password_empleado");
                    parrafoError="<p>"+data.data+"</p>";
                    document.getElementById("passwordError").innerHTML=null;
                    document.getElementById("passwordError").insertAdjacentHTML("beforeend",parrafoError);
                    password.value = password.value.substring(0, password.value.length - password.value.length);
                }
            }
        });
        }
        console.log(nombres+" "+apellidos+" "+email+" "+password+" "+direccion+" "+fecha_nacimiento+" "+sexo);
    });

</script>
<script>  
    (function () {
    'use strict'

    // Fetch all the forms we want to apply custom Bootstrap validation styles to
    var forms = document.querySelectorAll('.needs-validation')
    let parrafoError;

    // Loop over them and prevent submission
    Array.prototype.slice.call(forms)
      .forEach(function (form) {
        form.addEventListener('submit', function (event) {
            event.preventDefault();
          if (!form.checkValidity()) {
            event.preventDefault()
            event.stopPropagation()
          }

          form.classList.add('was-validated')
          event.stopPropagation()
        }, false)
      })
  })()
  </script>
{% endblock %}
